<%= form_with(model: [@post, Comment.new], local: false) do |f| %>
  <%= f.hidden_field :@post_id, value: @post.id %>

  <% if current_or_guest_user.email == 'guest@example.com' %>
  <div class="form-group d-flex">
    <% if current_user.profile_picture.attached? %>
      <%= image_tag current_user.profile_picture, size: "50x50", class: 'rounded-circle' %>
    <% end %>
    <%= f.text_field :content, placeholder: "コメント入力欄", class: "form-control" %>
    <%= f.submit "コメントする", class: "btn btn-custom guest-action" %>
  </div>

  <% else %>
  <div class="form-group d-flex">
    <%= image_tag current_user.profile_picture, size: "50x50", class: 'rounded-circle' %>
    <%= f.text_field :content, placeholder: "コメント入力欄", class: "form-control" %>
    <%= f.submit "コメントする", class: "btn btn-custom" %>
  </div>
<% end %>
<% end %>

<div id="comments">
<% @post.comments.each do |comment| %>
  <div class="comment-container ml-3" id="comment_<%= comment.id%>" >
    <div class="d-flex justify-content-between align-items-start">
      <div>
        <p class="comment-header"><%= comment.user.username %>:</p>
        <p class="comment-content"><%= comment.content %></p>
      </div>
      <% if current_user == comment.user %>
        <div>
          <%= link_to post_comment_path(@post, comment), method: :delete, remote: true,
          data: { confirm: "本当に削除しますか？" }, class: "comment-delete-link btn btn-link" do %>
            <i class="fas fa-trash" style="color: #FF6347;"></i>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
</div>


<script>
document.addEventListener('DOMContentLoaded', (event) => {
  let guestActions = document.querySelectorAll('.guest-action');
  guestActions.forEach((element) => {
    element.addEventListener('click', (event) => {
      event.preventDefault();
      alert('ゲストユーザーはこの操作はできません');
    });
  });
});

</script>